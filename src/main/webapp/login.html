<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="pictures/grzegorz.png">
    <title>Sign in</title>
    <link href="style/bootstrap/main.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

</head>

<body class="m-0 border-0 d-flex justify-content-center flex-column vh-100 bg-gradient-grzegorz overflow-hidden">
    <div class="align-self-center h-75">
        <div class="bg-light p-4 rounded">
            <p class="text-center fs-1 fw-semibold">Login</p>
            <form>
                <div class="mb-3">
                    <label for="InputEmail" class="form-label">Email address</label>
                    <input type="email" class="form-control" id="InputEmail" aria-describedby="emailHelp">
                </div>
                <div class="mb-3">
                    <label for="InputPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="InputPassword">
                </div>
                <button type="button" id="btn" class="btn btn-grzegorz-dark-green">Login</button>
            </form>
        </div>
        <div id="messagebox" class="flex-grow-1 mt-3 align-self-center">

        </div>
    </div>
    <!-- ================================================Toast=========================================================================== -->
    <div class="toast-container position-fixed bottom-0 end-0 p-2" id="toastBox">

    </div>


    <script>

        $(document).ready(function () {
            $("#btn").click(function () {
                const xhttp = new XMLHttpRequest();

                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {

                        var result = jQuery.parseJSON(this.responseText);

                        if (result.status == "ok") {
                            window.location.replace("Dashboard");
                        } else {
                            if (result.message) {
                                alert(result.message, 'danger');
                            }
                        }
                    }
                    if (this.readyState == 4 && this.status == 404) {
                        alert('Login service not responding', 'danger');
                    }

                };

                var requestArray = {}
                var email = document.getElementById("InputEmail").value;
                var password = document.getElementById("InputPassword").value;

                requestArray["email"] = email;
                requestArray["password"] = password;

                var requestJson = JSON.stringify(requestArray);

                //change this if you want to use it with POST method
                xhttp.open("POST", "LoginService", true);
                xhttp.send(requestJson);
            })

            $(document).keydown(function () {
                if (event.keyCode == 13) {
                    const xhttp = new XMLHttpRequest();

                    xhttp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200) {

                            var result = jQuery.parseJSON(this.responseText);

                            if (result.status == "ok") {
                                window.location.replace("Dashboard");
                            } else {
                                if (result.message) {
                                    alert(result.message, 'danger');
                                }
                            }
                        }
                        if (this.readyState == 4 && this.status == 404) {
                            alert('Login service not responding', 'danger');
                        }

                    };

                    var requestArray = {}
                    var email = document.getElementById("InputEmail").value;
                    var password = document.getElementById("InputPassword").value;

                    requestArray["email"] = email;
                    requestArray["password"] = password;

                    var requestJson = JSON.stringify(requestArray);

                    //change this if you want to use it with POST method
                    xhttp.open("POST", "LoginService", true);
                    xhttp.send(requestJson);
                }
            })

            //=====================message box=========================
            const alertPlaceholder = document.getElementById('liveAlertPlaceholder')

            const alert = (message, type) => {
                const wrapper = document.createElement('div')
                wrapper.innerHTML = [
                    `<div class="alert alert-` + type + ` alert-dismissible" role="alert">`,
                    `   <div>` + message + `</div>`,
                    '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                    '</div>'
                ].join('')

                messagebox.append(wrapper)
            }


        })

    </script>
    <!--===============================================================================================================================================================================================================-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"
        integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk"
        crossorigin="anonymous"></script>
</body>

</html>